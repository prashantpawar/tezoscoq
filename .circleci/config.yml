version: 2
dependencies:
  pre:
    - echo "Starting, TRACER"
    - sudo apt-get update; sudo apt-get install ocaml-nox
    - bash ./.circleci/opam-install.sh
    - sudo make install
  post:
    - echo "Done, TRACER"
jobs:
  build:
    docker:
      - image: buildpack-deps:trusty
    steps:
      - checkout
      - save_cache:
          keys: my-cache
          paths:
            - findlib-1.8.0
            - ocaml-4.06.0
      - run:
          name: Install prerequisites
          command: sudo apt-get update; sudo apt-get install build-essential
      - run:
          name: Install Ocaml
          command: bash ./.circleci/ocaml-install.sh
      - run:
          name: Install findlib
          command: bash ./.circleci/findlib-install.sh
      - run:
          name: Install OPAM
          command: bash ./.circleci/opam-install.sh
      - run:
          name: Test OPAM
          command: opam update
